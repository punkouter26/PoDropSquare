# Product Requirements Document (PRD)
## PoDropSquare

**Version**: 1.0  
**Last Updated**: October 27, 2025  
**Owner**: punkouter26  
**Status**: ‚úÖ Development Complete - Ready for Deployment

---

## üìã Executive Summary

**PoDropSquare** is a modern, high-performance drop square physics game built with Blazor WebAssembly and ASP.NET Core. Players stack falling squares to achieve the highest score while competing on a global leaderboard. The application showcases enterprise-grade architecture with Azure cloud integration, comprehensive monitoring, and automated CI/CD deployment.

### Key Differentiators
- ‚ú® **Browser-based** - No installation required
- üéÆ **Physics Engine** - Realistic Matter.js physics simulation
- üèÜ **Global Leaderboard** - Azure Table Storage-backed rankings
- üìä **Production Monitoring** - Application Insights telemetry
- üöÄ **Auto-Deployment** - GitHub Actions CI/CD pipeline
- üì± **Responsive Design** - Works on desktop and mobile

---

## üéØ Product Vision

### Mission Statement
Create an engaging, accessible browser game that demonstrates modern .NET 9.0 capabilities while providing a fun, competitive gaming experience.

### Target Audience
- **Primary**: Developers learning Blazor WebAssembly and .NET architecture
- **Secondary**: Casual gamers looking for quick, competitive gameplay
- **Tertiary**: DevOps engineers studying Azure deployment patterns

### Success Metrics
| Metric | Target | Measurement |
|--------|--------|-------------|
| Page Load Time | <2 seconds | Application Insights |
| API Response Time (P95) | <200ms | Application Insights |
| Daily Active Users | 100+ | KQL Query #19 |
| Error Rate | <1% | KQL Query #9 |
| Uptime | >99.5% | KQL Query #16 |
| User Session Duration | >5 minutes | KQL Query #3 |

---

## üéÆ Game Mechanics

### Core Gameplay

**Objective**: Stack falling squares to build the tallest tower without letting them fall off-screen.

**Rules**:
1. Squares drop from the top of the screen at regular intervals
2. Click/tap to release the square at current position
3. Squares obey realistic physics (gravity, friction, collisions)
4. Points awarded based on tower height and stability
5. Game ends when squares fall off-screen boundaries
6. Submit final score to global leaderboard with 3-letter initials

### Physics Parameters
- **Gravity**: Standard Matter.js gravity
- **Friction**: 0.3 (realistic stacking behavior)
- **Restitution**: 0.2 (minimal bounce)
- **Square Size**: 50x50 pixels
- **Drop Interval**: Configurable (default: 2 seconds)

### Scoring Algorithm
```
Base Score = Tower Height (pixels)
Bonus = Stability Factor (0-100)
Final Score = Base Score + Bonus
```

### Difficulty Progression
- Squares drop faster as score increases
- Smaller squares appear at higher levels
- Wind forces introduced at advanced stages (future feature)

---

## üèóÔ∏è Technical Architecture

### Technology Stack

#### Frontend
- **Framework**: Blazor WebAssembly (.NET 9.0)
- **UI Library**: Radzen.Blazor components
- **Physics**: Matter.js (JavaScript interop)
- **Styling**: CSS3 with responsive design
- **State Management**: Component-based state

#### Backend
- **Framework**: ASP.NET Core 9.0 Web API
- **Logging**: Serilog with structured logging
- **Data Storage**: Azure Table Storage
- **Health Checks**: ASP.NET Core Health Checks
- **API Documentation**: Swagger/OpenAPI

#### Infrastructure
- **Cloud Provider**: Microsoft Azure
- **IaC**: Bicep templates
- **Deployment**: Azure Developer CLI (azd)
- **Hosting**: Azure App Service (F1 Free tier)
- **Monitoring**: Application Insights + Log Analytics
- **CI/CD**: GitHub Actions with OIDC authentication

### Architecture Diagram (Conceptual)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Browser (Client)                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Blazor WebAssembly Application                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Game UI (Canvas + Matter.js)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Leaderboard Component                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Diagnostics Page                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ Client-side Error Logging                          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì HTTPS
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Azure App Service (ASP.NET Core)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ API Controllers                                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/scores (POST, GET)                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/scores/top10 (GET)                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/scores/leaderboard (GET)                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/scores/player/{initials}/rank (GET)           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/log/client (POST)                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ /api/log/error (POST)                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ /api/health (GET)                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Middleware Pipeline                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Error Handling (RFC 7807)                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Rate Limiting                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Request Logging (Serilog)                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ Response Caching                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Services Layer                                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ ScoreService                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ LeaderboardService                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Data Layer                                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ ScoreRepository                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ LeaderboardRepository                              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Azure Resources                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   Table      ‚îÇ  ‚îÇ     Log      ‚îÇ  ‚îÇ Application  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   Storage    ‚îÇ  ‚îÇ  Analytics   ‚îÇ  ‚îÇ   Insights   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ (Leaderboard)‚îÇ  ‚îÇ  Workspace   ‚îÇ  ‚îÇ (Telemetry)  ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Data Models

#### ScoreEntry (Azure Table Entity)
```csharp
{
  PartitionKey: "SCORES",
  RowKey: "{Guid}",
  PlayerInitials: "ABC",      // 3 chars, uppercase, alphanumeric
  Score: 1000,                 // Integer
  Timestamp: DateTime,         // Auto-generated
  GameDuration: 120,           // Seconds
  SquaresPlaced: 15            // Count
}
```

#### LeaderboardEntry
```csharp
{
  Rank: 1,
  PlayerInitials: "ABC",
  Score: 1000,
  Timestamp: DateTime
}
```

---

## üîå API Specification

### Base URL
- **Development**: `http://localhost:5000`
- **Production**: `https://app-podropsquare-prod-eastus.azurewebsites.net`

### Endpoints

#### 1. Submit Score
```http
POST /api/scores
Content-Type: application/json

{
  "playerInitials": "ABC",
  "score": 1000
}

Response 201 Created:
{
  "id": "guid",
  "playerInitials": "ABC",
  "score": 1000,
  "timestamp": "2025-10-27T12:00:00Z"
}
```

**Validation**:
- `playerInitials`: Required, 3 characters, alphanumeric, uppercase
- `score`: Required, positive integer, max 999999

#### 2. Get Top 10 Scores
```http
GET /api/scores/top10

Response 200 OK:
[
  {
    "playerInitials": "ABC",
    "score": 1000,
    "timestamp": "2025-10-27T12:00:00Z"
  },
  ...
]
```

#### 3. Get Full Leaderboard
```http
GET /api/scores/leaderboard?limit=100

Response 200 OK:
[
  {
    "rank": 1,
    "playerInitials": "ABC",
    "score": 1000,
    "timestamp": "2025-10-27T12:00:00Z"
  },
  ...
]
```

#### 4. Get Player Rank
```http
GET /api/scores/player/ABC/rank

Response 200 OK:
{
  "playerInitials": "ABC",
  "rank": 5,
  "score": 850,
  "totalPlayers": 100
}

Response 404 Not Found:
{
  "type": "https://tools.ietf.org/html/rfc7231#section-6.5.4",
  "title": "Not Found",
  "status": 404,
  "detail": "Player with initials 'ABC' not found"
}
```

#### 5. Client Logging
```http
POST /api/log/client
Content-Type: application/json

{
  "message": "User clicked start button",
  "level": "Information",
  "data": {
    "buttonId": "start-btn"
  }
}

Response 200 OK
```

#### 6. Error Logging
```http
POST /api/log/error
Content-Type: application/json

{
  "errorMessage": "TypeError: Cannot read property 'x' of null",
  "stackTrace": "at Game.update (game.js:42)",
  "url": "/game",
  "userAgent": "Mozilla/5.0..."
}

Response 200 OK
```

#### 7. Health Check
```http
GET /api/health

Response 200 OK:
{
  "status": "Healthy",
  "totalDuration": "00:00:00.1234567",
  "entries": {
    "self": {
      "status": "Healthy",
      "description": "API is running"
    },
    "azure-table-storage": {
      "status": "Healthy",
      "description": "Successfully connected"
    },
    "memory": {
      "status": "Healthy",
      "description": "Working set: 120 MB"
    }
  }
}
```

---

## üé® User Interface Requirements

### Design Philosophy

The PoDropSquare user interface is designed with three core principles: **simplicity**, **responsiveness**, and **feedback**. Every interaction should feel immediate and satisfying, with clear visual feedback that makes the physics-based gameplay intuitive even for first-time players. The UI draws inspiration from modern casual games while maintaining professional polish suitable for competitive play.

### Visual Design System

**Color Palette**:
- **Primary Brand**: Deep purple (#512BD4) - represents energy and creativity
- **Success/Active**: Vibrant green (#4CAF50) - indicates positive actions and achievements
- **Warning/Danger**: Amber-orange (#FF9800) - signals countdown urgency
- **Error**: Bright red (#FF6B6B) - communicates failures clearly
- **Neutral**: Soft grays and whites - provide clean, readable backgrounds
- **Accent**: Azure blue (#0078D4) - links to cloud infrastructure theme

**Typography**:
- **Headings**: Bold, sans-serif fonts (Segoe UI, Arial) for clarity
- **Score Display**: Large, monospaced numbers for easy reading during fast gameplay
- **Body Text**: Clean, legible fonts at minimum 14px for accessibility
- **Leaderboard**: Tabular layout with alternating row colors for scannability

**Motion & Animation**:
- Block drops have realistic gravity acceleration (Matter.js physics)
- Score increments animate with spring easing for satisfaction
- Timer transitions smoothly between colors (green‚Üíyellow‚Üíred) as time runs out
- UI panels slide in/out with 300ms ease-in-out transitions
- Victory/defeat screens fade in with confetti or particle effects

### Pages

#### 1. Home/Game Page (`/`)

This is the primary gameplay interface where players spend 95% of their time. The layout is optimized for focus and minimal distraction during intense gameplay moments.

- **Game Canvas** (center stage):
  - Full-screen canvas element (800x600px default, scales responsively)
  - Matter.js physics renderer with 60 FPS target
  - Real-time block dropping with visual trails
  - Collision effects with particle splashes
  - Background grid for spatial reference
  - Responsive to window resizing without breaking physics state
  
- **HUD Overlay** (non-intrusive, always visible):
  - **Current Score**: Top-right corner, large glowing numbers
  - **Survival Timer**: Top-left, circular progress indicator (20s countdown)
  - **Danger Timer**: Prominent center-top, pulsing red bar (2s countdown)
  - **Blocks Placed Counter**: Small badge showing total blocks dropped
  - **Combo Multiplier**: Appears briefly when achieving stable stacking
  
- **Control Panel** (bottom-fixed toolbar):
  - **Drop Block Button**: Large, touch-friendly (min 44x44px), color-coded by block type
  - **Pause/Resume**: Icon button for game control
  - **Sound Toggle**: Mute/unmute with visual indicator
  - **Settings Gear**: Quick access to preferences
  - **Help/Tutorial**: "?" icon for first-time player guidance
  
- **Instructions Panel** (collapsible sidebar):
  - Step-by-step gameplay tutorial with animated GIFs
  - Scoring mechanics explanation with examples
  - Physics tips: "stack flat surfaces for stability"
  - Keyboard shortcuts reference (Space = drop, P = pause)
  - Can be permanently dismissed after first play
  
- **Game Over Modal** (appears on game end):
  - Final score display with rank achievement animation
  - 3-character initial input field (auto-uppercase, alphanumeric only)
  - "Submit Score" button (primary CTA, glowing effect)
  - "Play Again" button (secondary, adjacent)
  - Social share buttons (Twitter, Facebook - future feature)
  - Leaderboard preview showing nearby ranks
  - Statistics: blocks placed, average stack height, stability rating

#### 2. High Scores Page (`/highscores`)

Dedicated leaderboard view for competitive players and spectators.

- **Top 10 Leaderboard Table** (hero section):
  - Podium-style visual for top 3 (gold, silver, bronze medals)
  - Columns: Rank | Player Initials | Score | Date Achieved | "View Replay" (future)
  - Alternating row colors for readability
  - Highlighted row if current player is in top 10
  - Auto-refresh every 30 seconds for live updates
  - Smooth scroll animations when new entries appear
  
- **Player Rank Lookup** (search widget):
  - Input field: "Enter your initials (e.g., ABC)"
  - Instant search with debouncing (300ms delay)
  - Results card showing: "You are rank #42 out of 1,250 players"
  - Nearby ranks displayed (¬±5 positions) for context
  - Visual indicator of percentile (e.g., "Top 3%!")
  - Link to player's score history (future feature)
  
- **Full Leaderboard** (scrollable, paginated):
  - Infinite scroll or Load More pagination (50 entries per page)
  - Filter options: Today | This Week | All Time
  - Sort options: Score (default) | Date | Alphabetical
  - Empty state: "No scores yet. Be the first!"
  - Loading skeleton screens for better perceived performance
  
- **Last Updated Timestamp**:
  - Footer display: "Updated 2 minutes ago"
  - Refresh button with spinner animation
  - Connection status indicator (green dot = live)

#### 3. Diagnostics Page (`/diag`)

This is a public-facing monitoring dashboard that provides transparency and debugging capabilities.

- **Health Status Dashboard** (hero section):
  - Large status badge: "Healthy" (green) / "Degraded" (yellow) / "Unhealthy" (red)
  - Last check timestamp with auto-refresh toggle
  - Overall system uptime percentage (rolling 24h)
  - Real-time connection indicator (WebSocket pulsing dot)
  
- **Component Health Cards** (grid layout):
  - **API Service**: Response time, request count (last hour), error rate
  - **Azure Table Storage**: Connection status, last write operation, latency
  - **Application Insights**: Telemetry pipeline status, events queued
  - **Memory**: Working set, GC collections, heap size
  - Each card color-coded by health state
  
- **API Response Times** (chart visualization):
  - Line chart showing P50, P95, P99 latencies over last hour
  - Endpoint breakdown: fastest/slowest routes
  - Recent requests table with timestamps and durations
  
- **System Information** (expandable sections):
  - **Environment**: Development/Production, deployment timestamp
  - **Version**: Git commit hash, build number
  - **Dependencies**: Framework versions (.NET 9.0, Azure SDK versions)
  - **Configuration**: Storage account region, insights instrumentation key (masked)
  
- **Diagnostic Actions** (admin toolbar):
  - "Refresh Health Check" button with loading spinner
  - "View Application Insights" link (opens Azure Portal, admin only)
  - "Download Logs" button (last 100 entries as JSON)
  - "Test Storage Connection" interactive probe
  
- **Error Log Stream** (live feed, optional):
  - Real-time scrolling log of exceptions and warnings
  - Filter by severity: All | Error | Warning | Info
  - Search by keyword or timestamp range
  - Export to CSV functionality

### Responsive Design & Adaptive Layouts

The UI must provide an optimal experience across all device categories and screen orientations.

**Desktop Experience** (>1024px width):
- Game canvas scaled to 800x600px or larger, centered on screen
- Sidebar navigation always visible with quick links
- Leaderboard in right rail, updating live without obscuring gameplay
- Multi-column layouts for statistics and settings
- Hover states on all interactive elements
- Keyboard shortcuts prominently displayed

**Tablet Experience** (768-1024px width):
- Stacked vertical layout prioritizing game canvas
- Collapsible navigation drawer from left edge
- Leaderboard accessible via tab or swipe gesture
- Touch targets expanded to minimum 44x44px
- Simplified HUD with fewer simultaneous indicators
- Landscape orientation preferred but portrait supported

**Mobile Experience** (<768px width, portrait priority):
- Full-screen game canvas with minimal chrome
- Single-column layout throughout application
- Bottom sheet for score submission and leaderboard
- Swipe gestures for navigation (swipe right = menu, swipe left = leaderboard)
- Simplified controls: one large "Drop" button, compact timer
- Haptic feedback on block drops (iOS/Android native vibration)
- Reduced particle effects to maintain 60 FPS on lower-end devices

**Breakpoint Strategy**:
```css
/* Mobile First Approach */
.game-container { width: 100%; }

@media (min-width: 768px) { /* Tablet */ }
@media (min-width: 1024px) { /* Desktop */ }
@media (min-width: 1440px) { /* Large Desktop */ }
```

### Accessibility (WCAG 2.1 AA Compliance)

**Keyboard Navigation**:
- Tab order follows logical flow (game ‚Üí controls ‚Üí leaderboard)
- All interactive elements accessible via Tab/Shift+Tab
- Keyboard shortcuts: Space (drop), P (pause), Esc (close modal), H (help)
- Focus indicators clearly visible (2px solid outline)
- Skip-to-content link for screen reader users

**Screen Reader Support**:
- Semantic HTML5 elements (`<header>`, `<nav>`, `<main>`, `<section>`)
- ARIA labels on all icons and image buttons
- Live regions for score updates (aria-live="polite")
- Descriptive alt text on all graphics
- Form labels explicitly associated with inputs
- Error messages announced immediately (aria-live="assertive")

**Visual Accessibility**:
- Minimum contrast ratio 4.5:1 for normal text, 3:1 for large text
- Text resizable up to 200% without layout breaking
- Color not sole indicator of information (icons + text)
- Optional high-contrast theme (toggle in settings)
- Reduced motion mode (respects `prefers-reduced-motion` media query)

**Internationalization Readiness** (future):
- English (default), with i18n framework in place
- Right-to-left (RTL) layout support via CSS Flexbox/Grid
- Numeric formatting respects locale (comma vs period)
- Date/time displays using browser's timezone

---

## üîí Security Requirements

### Authentication & Authorization
- **Current**: No authentication (public leaderboard)
- **Future**: Optional user accounts with OAuth2

### Data Validation
- ‚úÖ Input sanitization on all API endpoints
- ‚úÖ Player initials: 3 chars, alphanumeric, uppercase only
- ‚úÖ Score validation: Positive integer, max 999999
- ‚úÖ Rate limiting: 100 requests/minute per IP

### Security Headers
- ‚úÖ HTTPS enforcement
- ‚úÖ Content Security Policy (CSP)
- ‚úÖ X-Frame-Options: DENY
- ‚úÖ X-Content-Type-Options: nosniff

### Data Privacy
- No personally identifiable information (PII) collected
- IP addresses logged for rate limiting (30-day retention)
- Optional: GDPR compliance for EU users

---

## üìä Monitoring & Observability

### Key Performance Indicators (KPIs)

| KPI | Target | Alert Threshold |
|-----|--------|-----------------|
| API Latency (P95) | <200ms | >500ms |
| Error Rate | <1% | >5% |
| Availability | >99.5% | <99% |
| Page Load Time | <2s | >5s |
| Memory Usage | <500MB | >800MB |

### Telemetry Collection
- **Application Insights**: Requests, dependencies, exceptions
- **Serilog**: Structured logging to files and App Insights
- **Client Logs**: JavaScript errors, user actions
- **Custom Events**: Score submissions, game completions

### Dashboards
1. **Real-Time Monitoring** - Active users, error rate, latency
2. **Weekly Executive Summary** - DAU, retention, performance
3. **Game Analytics** - Scores, leaderboard activity, player ranks

### Alerts
1. **High Error Rate** (>5% in 5 minutes)
2. **Slow Performance** (P95 >1000ms)
3. **Dependency Failure** (Table Storage unavailable)
4. **No Health Checks** (0 requests in 10 minutes)

See `/docs/KQL-QUERIES.md` for 31 production-ready monitoring queries.

---

## üöÄ Deployment & Operations

### Environments

| Environment | Purpose | URL | Auto-Deploy |
|-------------|---------|-----|-------------|
| **Local** | Development | http://localhost:5000 | Manual |
| **Dev** | Feature testing | https://app-podropsquare-dev-eastus.azurewebsites.net | On push to `001-podropsquare-is-a` |
| **Prod** | Production | https://app-podropsquare-prod-eastus.azurewebsites.net | On push to `main` |

### CI/CD Pipeline

**GitHub Actions Workflow** (`.github/workflows/azure-dev.yml`):
1. **Build** - Compile, test, create artifacts
2. **Deploy** - Provision Azure resources, deploy app
3. **E2E Tests** - Run Playwright tests against live app

**Deployment Steps**:
```bash
# 1. Build and test
dotnet restore
dotnet build --configuration Release
dotnet test

# 2. Provision infrastructure
azd provision --no-prompt

# 3. Deploy application
azd deploy --no-prompt

# 4. Verify deployment
curl https://YOUR_APP/api/health
```

### Rollback Strategy
- **Option 1**: Redeploy previous commit via GitHub
- **Option 2**: Azure Portal deployment slots
- **Option 3**: `azd down` + redeploy from git tag

### Disaster Recovery
- **RTO**: 1 hour (Recovery Time Objective)
- **RPO**: 24 hours (Recovery Point Objective)
- **Backup**: Azure Table Storage geo-redundancy
- **Runbook**: `/docs/DISASTER-RECOVERY.md` (future)

---

## üìà Roadmap & Future Features

### Phase 1: MVP ‚úÖ (Complete)
- [x] Core game mechanics
- [x] Global leaderboard
- [x] Azure deployment
- [x] CI/CD pipeline
- [x] Monitoring & telemetry

### Phase 2: Enhanced Gameplay (Q1 2026)
- [ ] Difficulty levels (Easy, Medium, Hard)
- [ ] Power-ups (slow motion, freeze, ghost square)
- [ ] Achievement system
- [ ] Sound effects and music
- [ ] Animated backgrounds

### Phase 3: Social Features (Q2 2026)
- [ ] User accounts with OAuth2
- [ ] Friend leaderboards
- [ ] Challenge mode (1v1)
- [ ] Share score on social media
- [ ] Weekly tournaments

### Phase 4: Mobile App (Q3 2026)
- [ ] Native iOS app (MAUI)
- [ ] Native Android app (MAUI)
- [ ] Offline mode with sync
- [ ] Push notifications
- [ ] In-app purchases (cosmetics)

### Phase 5: Multiplayer (Q4 2026)
- [ ] Real-time multiplayer (SignalR)
- [ ] Spectator mode
- [ ] Replay system
- [ ] Leaderboard seasons
- [ ] Global tournaments

---

## üí∞ Cost Analysis

### Azure Resources (Production)

| Resource | SKU | Monthly Cost |
|----------|-----|--------------|
| App Service Plan | F1 (Free) | $0 |
| Storage Account | Standard LRS | $0.02/GB |
| Log Analytics | Pay-as-you-go | $2.30/GB |
| Application Insights | Pay-as-you-go | First 5GB free |
| **TOTAL** | | **~$10-20/month** |

### Scaling Costs

| Traffic Level | Users/Day | Est. Cost/Month |
|---------------|-----------|-----------------|
| MVP | <100 | $10 |
| Growth | 100-1000 | $20-50 |
| Popular | 1000-10000 | $50-200 |
| Viral | >10000 | $200-1000 |

### Cost Optimization
- ‚úÖ Use F1 free tier for App Service
- ‚úÖ Enable adaptive sampling in App Insights
- ‚úÖ 30-day log retention
- ‚úÖ Shared storage account across environments
- ‚úÖ Auto-scale only on production

---

## üìö Documentation

### Developer Documentation
- **README.md** - Project overview, getting started
- **AGENTS.MD** - AI coding agent best practices
- **/docs/KQL-QUERIES.md** - 31 monitoring queries
- **/docs/APPLICATION-INSIGHTS-SETUP.md** - Telemetry configuration
- **/docs/ARCHITECTURE.md** - Detailed architecture diagrams
- **Program.cs** - Quick KQL reference in code comments

### Deployment Documentation
- **.github/CICD-SETUP.md** - GitHub Actions configuration
- **.github/PHASE5-SUMMARY.md** - CI/CD implementation details
- **azure.yaml** - azd configuration
- **/infra/** - Bicep templates with inline comments

### API Documentation
- **Swagger UI** - Available at `/swagger` in development
- **OpenAPI Spec** - Auto-generated from controllers
- **PoDropSquare.http** - REST Client test file

---

## ‚úÖ Definition of Done

### Feature Complete Criteria
- [ ] All acceptance criteria met
- [ ] Unit tests written and passing (>80% coverage)
- [ ] Integration tests passing
- [ ] E2E tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated
- [ ] Deployed to dev environment
- [ ] QA testing complete
- [ ] Performance validated (<200ms P95)
- [ ] Security scan passed
- [ ] Deployed to production

### Quality Gates
- **Build**: Must compile with zero warnings
- **Tests**: All tests must pass (unit, integration, E2E)
- **Coverage**: >80% code coverage
- **Performance**: P95 latency <200ms
- **Security**: No critical vulnerabilities
- **Accessibility**: WCAG 2.1 AA compliant

---

## ü§ù Stakeholders

| Role | Name | Responsibility |
|------|------|----------------|
| **Product Owner** | punkouter26 | Vision, priorities, acceptance |
| **Tech Lead** | punkouter26 | Architecture, code quality |
| **DevOps** | punkouter26 | CI/CD, infrastructure, monitoring |
| **QA** | GitHub Actions | Automated testing |
| **Designer** | TBD | UI/UX design (future) |

---

## üìù Appendix

### Glossary
- **DAU**: Daily Active Users
- **P95**: 95th percentile (latency metric)
- **KQL**: Kusto Query Language (Azure logs)
- **azd**: Azure Developer CLI
- **OIDC**: OpenID Connect (authentication)
- **IaC**: Infrastructure as Code

### References
- [Blazor Documentation](https://learn.microsoft.com/en-us/aspnet/core/blazor/)
- [Matter.js Physics Engine](https://brm.io/matter-js/)
- [Azure Table Storage](https://learn.microsoft.com/en-us/azure/storage/tables/)
- [Application Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview)
- [GitHub Actions](https://docs.github.com/en/actions)

### Change Log

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-10-27 | Initial PRD - MVP complete |

---

**Status**: ‚úÖ **APPROVED FOR PRODUCTION**  
**Next Review**: 2026-01-27 (Quarterly)  
**Document Owner**: punkouter26
